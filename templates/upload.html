{% extends "base.html" %}

{% block title %}New Trades{% endblock %}

{% block content %}
<style>
.upload-container {
  display: flex;
  height: 100%;
}

.upload-left {
  width: 40%;
  background: #ffffff;
  padding: 40px;
  box-shadow: 2px 0 10px rgba(0,0,0,0.1);
}

.upload-right {
  width: 60%;
  padding: 60px;
}

.dropzone {
  width: 100%;
  height: 200px;
  border: 3px dashed #666;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  font-size: 18px;
  color: #666;
  cursor: pointer;
}

.dropzone.dragover {
  border-color: #00aaff;
  background: #e6f7ff;
}

button {
  margin-top: 15px;
  width: 100%;
  padding: 10px;
}

#message {
  margin-top: 15px;
  font-weight: bold;
}

.success { color: green; }
.error { color: red; }
</style>

<div class="upload-container">

  <!-- LEFT: UPLOAD -->
  <div class="upload-left">
    <h2>Upload CSV</h2>

    <div id="dropzone" class="dropzone">
      Drop CSV file here<br>or click to select
    </div>

    <input type="file" id="fileInput" accept=".csv" hidden>
    <button onclick="uploadFile()">Upload</button>

    <div id="message"></div>
  </div>

  <!-- RIGHT: EXPLANATION -->
  <div class="upload-right">
    <h2>How to uplade file</h2>
    <p>How to uplade file</p>
  </div>

</div>

<script>
const dropzone = document.getElementById("dropzone");
const fileInput = document.getElementById("fileInput");
const messageDiv = document.getElementById("message");
let selectedFile = null;

dropzone.onclick = () => fileInput.click();

fileInput.onchange = (e) => {
  selectedFile = e.target.files[0];
  dropzone.innerHTML = "Selected: " + selectedFile.name;
};

dropzone.ondragover = (e) => {
  e.preventDefault();
  dropzone.classList.add("dragover");
};

dropzone.ondragleave = () => dropzone.classList.remove("dragover");

dropzone.ondrop = (e) => {
  e.preventDefault();
  dropzone.classList.remove("dragover");
  selectedFile = e.dataTransfer.files[0];
  dropzone.innerHTML = "Dropped: " + selectedFile.name;
};

function uploadFile() {
  messageDiv.innerHTML = "";
  messageDiv.className = "";

  if (!selectedFile) {
    messageDiv.innerHTML = "No file selected";
    messageDiv.className = "error";
    return;
  }

  const formData = new FormData();
  formData.append("file", selectedFile);

  fetch("{{ url_for('upload_file') }}", {
    method: "POST",
    body: formData
  })
  .then(res => res.json())
  .then(data => {
    if (data.error) {
      messageDiv.innerHTML = data.error;
      messageDiv.className = "error";
    } else {
      messageDiv.innerHTML = "âœ… Upload successful: " + data.filename;
      messageDiv.className = "success";
      dropzone.innerHTML = "Drop another CSV file here";
      selectedFile = null;
    }
  })
  .catch(() => {
    messageDiv.innerHTML = "Upload failed";
    messageDiv.className = "error";
  });
}
</script>

{% endblock %}
